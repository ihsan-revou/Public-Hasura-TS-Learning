# Komponen Berbasis Kontainer

Manifes statis yang digunakan untuk membangun sebuah klaster harus mencakup komponen-komponen penting dari control plane: `etcd`, `kube-apiserver`, `kube-scheduler`, dan `kube-controller-manager`. Anda dapat menyediakan manifes Pod kustom tambahan sesuai kebutuhan, tetapi batasi hanya untuk Pod yang benar-benar harus berjalan sebelum Kubernetes API tersedia atau terdaftar dalam sistem federasi. Jika suatu beban kerja dapat diinstal melalui API server nanti, lakukanlah. Pod yang dibuat dengan manifes statis hanya dapat dikelola dengan mengedit manifes tersebut di disk mesin, yang kurang mudah diakses dan sulit untuk diautomasi.

Jika menggunakan `kubeadm`, yang sangat disarankan, manifes statis untuk control plane Anda, termasuk `etcd`, akan dibuat ketika node control plane diinisialisasi dengan `kubeadm init`. Setiap spesifikasi flag yang diperlukan untuk komponen ini dapat diberikan ke `kubeadm` menggunakan file konfigurasi `kubeadm`. Utilitas bootstrap yang telah kita bahas sebelumnya, yang memanggil `kubeadm`, dapat menulis file konfigurasi `kubeadm` berbasis template, misalnya.

Hindari mengustomisasi manifes Pod statis secara langsung dengan utilitas bootstrap Anda. Jika memang diperlukan, Anda dapat melakukan pembuatan manifes statis dan inisialisasi klaster secara terpisah dengan `kubeadm`, yang memberi Anda kesempatan untuk menyuntikkan kustomisasi jika diperlukan. Namun, lakukan ini hanya jika benar-benar penting dan tidak dapat dicapai melalui konfigurasi `kubeadm`. Proses bootstrap control plane Kubernetes yang lebih sederhana akan lebih kuat, lebih cepat, dan lebih sedikit mengalami masalah saat melakukan pembaruan versi Kubernetes.

`Kubeadm` juga akan menghasilkan aset TLS yang ditandatangani sendiri yang diperlukan untuk menghubungkan komponen control plane secara aman. Sekali lagi, hindari mengubah ini. Jika Anda memiliki persyaratan keamanan yang mengharuskan penggunaan CA perusahaan sebagai sumber kepercayaan, Anda dapat melakukannya. Jika ini adalah persyaratan, penting untuk dapat mengotomatisasi akuisisi otoritas perantara. Ingatlah bahwa jika sistem bootstrap klaster Anda aman, kepercayaan pada CA yang ditandatangani sendiri untuk control plane akan tetap aman dan hanya berlaku untuk control plane dari satu klaster.

Sekarang setelah kita membahas dasar-dasar instalasi Kubernetes, mari kita beralih ke perhatian utama setelah Anda memiliki klaster yang berjalan. Kita akan mulai dengan pendekatan untuk menginstal add-on esensial ke dalam Kubernetes. Add-on ini merupakan komponen tambahan yang dibutuhkan selain Kubernetes untuk menghadirkan platform aplikasi yang siap produksi. Kemudian kita akan membahas strategi dalam melakukan pembaruan platform Anda.

## Add-ons

Add-on klaster mencakup layanan platform yang dilapiskan ke klaster Kubernetes. Kami tidak akan membahas apa yang harus diinstal sebagai add-on dalam bagian ini, karena ini merupakan topik dari bab lain dalam buku ini. Sebaliknya, kami akan melihat cara menginstal komponen yang akan mengubah klaster Kubernetes mentah menjadi platform yang siap produksi dan ramah pengembang.

Add-on yang Anda tambahkan ke klaster harus dipertimbangkan sebagai bagian dari model deployment. Instalasi add-on biasanya merupakan fase terakhir dari deployment klaster. Add-on ini harus dikelola dan diberi versi bersamaan dengan klaster Kubernetes itu sendiri. Sebaiknya anggap Kubernetes dan add-on yang membentuk platform sebagai satu paket yang diuji dan dirilis bersama, karena akan ada ketergantungan versi dan konfigurasi antara komponen platform tertentu.

`Kubeadm` menginstal add-on "wajib" yang diperlukan untuk lulus uji kepatuhan proyek Kubernetes, termasuk `cluster DNS` dan `kube-proxy`, yang mengimplementasikan sumber daya `Service` Kubernetes. Namun, masih ada banyak komponen lain yang harus diterapkan setelah `kubeadm` selesai bekerja. Salah satu contohnya adalah plug-in antarmuka jaringan kontainer (Container Network Interface/CNI). Klaster Anda tidak akan berfungsi dengan baik tanpa jaringan Pod. Pada akhirnya, Anda akan memiliki daftar panjang komponen yang perlu ditambahkan ke klaster Anda, biasanya dalam bentuk `DaemonSets`, `Deployments`, atau `StatefulSets` yang akan menambahkan fungsionalitas ke platform Kubernetes yang Anda bangun.

Sebelumnya, dalam bagian "Arsitektur dan Topologi," kita membahas federasi klaster dan pendaftaran klaster baru dalam sistem tersebut. Ini biasanya merupakan langkah awal sebelum instalasi add-on, karena sistem dan definisi untuk instalasi sering kali berada di klaster manajemen.

Apa pun arsitektur yang digunakan, setelah pendaftaran tercapai, instalasi add-on klaster dapat dipicu. Proses instalasi ini akan berupa serangkaian panggilan ke API server klaster untuk membuat sumber daya Kubernetes yang diperlukan untuk setiap komponen. Panggilan ini dapat berasal dari sistem di luar klaster atau dari dalam klaster itu sendiri. Salah satu pendekatan untuk menginstal add-on adalah dengan menggunakan pipeline continuous delivery menggunakan alat yang sudah ada seperti `Jenkins`. Bagian "continuous" dalam konteks ini bukan mengacu pada pembaruan perangkat lunak secara terus-menerus, tetapi lebih pada pemicu instalasi ke target baru.

Pendekatan lain yang lebih alami bagi Kubernetes adalah menggunakan `Kubernetes Operator`. Pendekatan ini melibatkan perluasan API Kubernetes dengan satu atau lebih `Custom Resources` yang memungkinkan Anda mendefinisikan komponen add-on untuk klaster beserta versinya. Selain itu, operator juga menulis logika kontroler yang dapat mengeksekusi instalasi add-on berdasarkan spesifikasi yang ditentukan dalam custom resource.

Pendekatan ini berguna karena menyediakan sumber kebenaran yang terpusat dan jelas mengenai add-on dalam klaster. Lebih penting lagi, ini memungkinkan pengelolaan siklus hidup add-on secara programatik. Namun, kompleksitas pengembangan dan pemeliharaan perangkat lunak yang lebih kompleks adalah kekurangannya. Jika Anda memilih kompleksitas ini, pastikan Anda juga menerapkan mekanisme pembaruan "day-2" dan manajemen yang akan mengurangi beban kerja manusia di masa depan. Jika Anda hanya berhenti pada instalasi "day-1" dan tidak mengembangkan logika serta fungsionalitas untuk mengelola pembaruan, maka Anda akan mengambil beban pengembangan perangkat lunak yang besar dengan sedikit manfaat berkelanjutan.

Konsep `add-on operator` tidak sepenuhnya terpisah dari sistem eksternal seperti CI/CD. Dalam praktiknya, keduanya lebih mungkin digunakan secara bersamaan. Misalnya, Anda dapat menggunakan pipeline CD untuk menginstal operator dan `Custom Resources` add-on, kemudian membiarkan operator menangani sisanya. Operator juga mungkin perlu mengambil manifes instalasi dari repositori kode yang berisi templat Kubernetes untuk add-on.

Menggunakan operator dengan cara ini mengurangi ketergantungan eksternal, yang meningkatkan keandalan. Namun, ketergantungan eksternal tidak dapat sepenuhnya dihilangkan. Gunakan pendekatan operator hanya jika Anda memiliki insinyur yang memahami pola `Kubernetes Operator` dengan baik. Jika tidak, tetap gunakan alat dan sistem yang telah dikuasai tim Anda sambil meningkatkan pemahaman mereka di bidang ini.

Dengan ini, kita menyelesaikan pembahasan tentang instalasi klaster Kubernetes dan add-on. Selanjutnya, kita akan membahas pembaruan platform sebagai bagian dari perhatian "day-2".

